/*! df-tab-menu - v0.1.1 - Responsive tabs with dropdown menu - built 2014-07-26 - License MIT (http://www.opensource.org/licenses/MIT) */
!function(){"use strict";angular.module("digitalfondue.dftabmenu",[]).directive("dfTabMenu",["$window",function(a){return{restrict:"E",compile:function(b,c){var d=a.document,e=b[0];b.append('<ol class="df-tab-menu" main-menu></ol>');for(var f=b.find("ol"),g=angular.element(e.querySelectorAll("li[menu-item]")),h=0;h<g.length;h++)f.append(g[h]);b.find("ol").append("<li more-menu-item><a href dropdown-toggle>"+c.moreMenuTemplate+'</a><ul more-menu class="df-tab-menu-dropdown"></ul></li>');for(var i=angular.element(e.querySelector("ul.df-tab-menu-dropdown")),j=e.querySelectorAll("ol > li[menu-item]"),h=0;h<g.length;h++)i.append(angular.element(j[h]).clone());return function(b,c,e){var f=c[0],g=angular.element(a),h=null,i=f.querySelectorAll("ol > li[menu-item]").length,j={},k=function(){var a=f.querySelectorAll("ol > li[menu-item]");angular.element(a).removeClass("ng-hide");for(var b=0;b<a.length;b++){var c=a[b].offsetWidth;c>0&&(j[b]=a[b].offsetWidth)}},l=(b.$watch(function(){var a=f.querySelector("ol[main-menu].df-tab-menu > li[menu-item].df-tab-menu-active");return null!=a?a.scrollWidth:0},function(a){null!=a&&a>0&&(k(),o())},!0),function(){return angular.element(f.querySelector("ol > li[more-menu-item]")).removeClass("ng-hide"),f.querySelector("ol[main-menu].df-tab-menu > li[more-menu-item]").offsetWidth}),m=function(a,b){var c=[],d=j[b]+l();c.push(b);for(var e=f.querySelectorAll("ol > li[menu-item]"),g=0;g<e.length;g++)if(g!=b){if(d+=j[g],d>a)return c;c.push(g)}return c},n=function(){for(var a=f.querySelectorAll("ol > li[menu-item]"),b=0;b<a.length;b++)if(angular.element(a[b]).hasClass("df-tab-menu-active"))return b},o=function(){var a=f.querySelector("ol").offsetWidth,c=n(),d=m(a,c);if(d.length<i){h=d.length,angular.element(f.querySelector("ol > li[more-menu-item]")).removeClass("ng-hide");for(var e=f.querySelectorAll("ol > li[menu-item]"),g=f.querySelectorAll("ul[more-menu] > li[menu-item]"),j=0;j<e.length;j++)-1!=d.indexOf(j)?(angular.element(e[j]).removeClass("ng-hide"),angular.element(g[j]).addClass("ng-hide")):(angular.element(e[j]).addClass("ng-hide"),angular.element(g[j]).removeClass("ng-hide"))}else h=null,angular.element(f.querySelector("ol > li[more-menu-item]")).addClass("ng-hide"),angular.element(f.querySelectorAll("ol > li[menu-item]")).removeClass("ng-hide"),b.$evalAsync(function(){b.dropdownOpen=!1})};b.dropdownOpen=!1;var p=function(){b.$apply(function(){b.dropdownOpen=!1})};b.$watch("dropdownOpen",function(a){a?(angular.element(f.querySelector(".df-tab-menu a[dropdown-toggle]")).addClass("df-tab-menu-dropdown-open"),angular.element(d).bind("click",p)):(angular.element(f.querySelector(".df-tab-menu a[dropdown-toggle]")).removeClass("df-tab-menu-dropdown-open"),angular.element(d).unbind("click",p))});var q=function(a){a.stopPropagation(),b.$apply(function(){b.dropdownOpen=!b.dropdownOpen})};angular.element(f.querySelector(".df-tab-menu a[dropdown-toggle]")).bind("click",q),e.$observe("menuControl",function(a){if(null==f.querySelector('ol > li[menu-item="'+a+'"]'))throw"Invalid state: "+a+", please verify the menu-item(s) configuration";angular.element(f.querySelector("ol > li.df-tab-menu-active")).removeClass("df-tab-menu-active"),angular.element(f.querySelector('ol > li[menu-item="'+a+'"]')).addClass("df-tab-menu-active"),b.dropdownOpen=!1,h=null,o()}),g.bind("resize",o),b.$on("$destroy",function(){g.unbind("resize",o),angular.element(f.querySelector(".df-tab-menu a[dropdown-toggle]")).unbind("click",q),angular.element(d).unbind("click",p)})}}}}])}();