/*! df-tab-menu - v0.1.3 - Responsive tabs with dropdown menu - built 2014-09-08 - License MIT (http://www.opensource.org/licenses/MIT) */
!function(){"use strict";angular.module("digitalfondue.dftabmenu",[]).directive("dfTabMenu",["$window","$timeout",function(a,b){return{restrict:"E",compile:function(c,d){var e=a.document,f=c[0];c.append('<ol class="df-tab-menu" main-menu></ol>');for(var g=c.find("ol"),h=angular.element(f.querySelectorAll("li[menu-item]")),i=0;i<h.length;i++)g.append(h[i]);c.find("ol").append("<li more-menu-item><a href dropdown-toggle>"+d.moreMenuTemplate+'</a><ul more-menu class="df-tab-menu-dropdown"></ul></li>');for(var j=angular.element(f.querySelector("ul.df-tab-menu-dropdown")),k=f.querySelectorAll("ol > li[menu-item]"),i=0;i<h.length;i++)j.append(angular.element(k[i]).clone());return function(c,d,f){var g=d[0],h=angular.element(a),i=null,j=!1,k=function(){var a=g.querySelectorAll("ol > li[menu-item]");angular.element(a).removeClass("ng-hide");for(var b=[],c=0;c<a.length;c++){var d=a[c].offsetWidth;d>0&&(b[c]=a[c].offsetWidth)}return b},l=(c.$watch(function(){var a=g.querySelector("ol[main-menu].df-tab-menu > li[menu-item].df-tab-menu-active");return null!=a?a.scrollWidth:0},function(a){null!=a&&a>0&&o()},!0),function(){return angular.element(g.querySelector("ol > li[more-menu-item]")).removeClass("ng-hide"),g.querySelector("ol[main-menu].df-tab-menu > li[more-menu-item]").offsetWidth}),m=function(a,b){var c=[],d=k(),e=d[b]+l()+40;c.push(b);for(var f=g.querySelectorAll("ol > li[menu-item]"),h=0;h<f.length;h++)if(h!=b){if(e+=d[h],e>a)return c;c.push(h)}return c},n=function(){for(var a=g.querySelectorAll("ol > li[menu-item]"),b=0;b<a.length;b++)if(angular.element(a[b]).hasClass("df-tab-menu-active"))return b},o=function(){var a=g.querySelector("ol").offsetWidth,b=n(),c=m(a,b);if(c.length<g.querySelectorAll("ol > li[menu-item]").length){i=c.length,angular.element(g.querySelector("ol > li[more-menu-item]")).removeClass("ng-hide");for(var d=g.querySelectorAll("ol > li[menu-item]"),e=g.querySelectorAll("ul[more-menu] > li[menu-item]"),f=0;f<d.length;f++)-1!=c.indexOf(f)?(angular.element(d[f]).removeClass("ng-hide"),angular.element(e[f]).addClass("ng-hide")):(angular.element(d[f]).addClass("ng-hide"),angular.element(e[f]).removeClass("ng-hide"))}else i=null,angular.element(g.querySelector("ol > li[more-menu-item]")).addClass("ng-hide"),angular.element(g.querySelectorAll("ol > li[menu-item]")).removeClass("ng-hide"),j=!1,q()},p=function(a){j=!1,q(a)},q=function(){j?(angular.element(g.querySelector(".df-tab-menu a[dropdown-toggle]")).addClass("df-tab-menu-dropdown-open"),angular.element(e).bind("click",p)):(angular.element(g.querySelector(".df-tab-menu a[dropdown-toggle]")).removeClass("df-tab-menu-dropdown-open"),angular.element(e).unbind("click",p))},r=function(a){a&&a.stopPropagation(),j=!j,q()};angular.element(g.querySelector(".df-tab-menu a[dropdown-toggle]")).bind("click",r),f.$observe("menuControl",function(a){if(null==g.querySelector('ol > li[menu-item="'+a+'"]'))throw"Invalid state: "+a+", please verify the menu-item(s) configuration";angular.element(g.querySelector("ol > li.df-tab-menu-active")).removeClass("df-tab-menu-active"),angular.element(g.querySelector('ol > li[menu-item="'+a+'"]')).addClass("df-tab-menu-active"),i=null,o()}),h.bind("resize",o),c.$on("$destroy",function(){h.unbind("resize",o),angular.element(g.querySelector(".df-tab-menu a[dropdown-toggle]")).unbind("click",r),angular.element(e).unbind("click",p)});var s;c.$watch(function(){b.cancel(s),s=b(o,25,!1)})}}}}])}();